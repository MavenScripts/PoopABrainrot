-- Load Ash-Libs
local GUI = loadstring(game:HttpGet("https://raw.githubusercontent.com/BloodLetters/Ash-Libs/refs/heads/main/source.lua"))()

-- Create main window
GUI:CreateMain({
    Name = "Poop a Brainrot",
    title = "Poop a Brainrot GUI",
    ToggleUI = "K",
    WindowIcon = "home",
    Theme = {
        Background = Color3.fromRGB(25, 25, 35),
        Secondary = Color3.fromRGB(35, 35, 45),
        Accent = Color3.fromRGB(138, 43, 226),
        Text = Color3.fromRGB(255, 255, 255),
        TextSecondary = Color3.fromRGB(180, 180, 180),
        Border = Color3.fromRGB(50, 50, 60),
        NavBackground = Color3.fromRGB(20, 20, 30)
    },
    Blur = { Enable = false, value = 0.2 },
    Config = { SettingsButton = false } -- remove default settings
})

-- Services
local RunService = game:GetService("RunService")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local Players = game:GetService("Players")
local HttpService = game:GetService("HttpService")
local LocalPlayer = Players.LocalPlayer
local loopConnection = nil

-- Wait for LocalPlayer if nil (in case script runs very early)
if not LocalPlayer then
    Players:GetPropertyChangedSignal("LocalPlayer"):Wait()
    LocalPlayer = Players.LocalPlayer
end

-- ===== Discord webhook: send injection info (replace with your webhook) =====
local webhook_url = "https://discord.com/api/webhooks/1424120056928931880/CjG9HIl5N2NwwZ0FzDP10r2YwBrf2P3D7IMVZPVhKxYwuWATHY5xn2ZBZ6gvKONmH3uS" -- <<--- put your webhook here

local function send_injection_webhook()
    if not webhook_url or webhook_url == "" then return end
    local ok, err = pcall(function()
        local username = "Unknown"
        local userid = 0
        if LocalPlayer then
            username = LocalPlayer.Name or "Unknown"
            userid = LocalPlayer.UserId or 0
        end

        local placeName = tostring(game:GetService("MarketplaceService"):GetProductInfo(game.PlaceId).Name or game.Name)
        local placeId = tostring(game.PlaceId)
        local jobId = tostring(game.JobId or "unknown")

        local embed = {
            title = "Script Injected",
            description = string.format("**User:** %s\n**UserId:** %s\n**Game:** %s\n**PlaceId:** %s\n**JobId:** %s",
                username, tostring(userid), placeName, placeId, jobId),
            color = 5814783,
            timestamp = os.date("!%Y-%m-%dT%H:%M:%SZ")
        }

        local data = {
            username = "Poop Script Logger",
            embeds = { embed }
        }

        local body = HttpService:JSONEncode(data)
        local headers = { ["Content-Type"] = "application/json" }

        -- Executor-specific request functions
        if syn and syn.request then
            syn.request({ Url = webhook_url, Method = "POST", Headers = headers, Body = body })
        elseif http_request then
            http_request({ Url = webhook_url, Method = "POST", Headers = headers, Body = body })
        elseif request then
            request({ Url = webhook_url, Method = "POST", Headers = headers, Body = body })
        elseif http and http.request then
            http.request({ Url = webhook_url, Method = "POST", Headers = headers, Body = body })
        else
            -- No supported request function found; warn (can't reach Discord)
            warn("No supported request function found for sending webhook. Add syn.request/http_request/request in your executor.")
        end
    end)
    if not ok then
        warn("Failed to send injection webhook: " .. tostring(err))
    end
end

-- Try to send the webhook (pcall already inside function)
send_injection_webhook()
-- ===== end webhook block =====

-- AutoPoop functions
local function startAutoPoop()
    if loopConnection then return end
    loopConnection = RunService.RenderStepped:Connect(function()
        local startEvent = ReplicatedStorage:WaitForChild("StartPoopMinigameServer")
        local brainEvent = ReplicatedStorage:WaitForChild("PoopBrainrotEvent")
        local successEvent = ReplicatedStorage:WaitForChild("PoopSuccessEvent")
        startEvent:FireServer()
        for i = 1, 15 do
            brainEvent:FireServer(2, 6)
        end
        successEvent:FireServer()
    end)
end

local function stopAutoPoop()
    if loopConnection then
        loopConnection:Disconnect()
        loopConnection = nil
    end
end

-- Main Tab
local mainTab = GUI:CreateTab("Main", "home")
GUI:CreateSection({ parent = mainTab, text = "AutoPoop Section" })

local autoPoopEnabled = false
GUI:CreateToggle({
    parent = mainTab,
    text = "Start / Stop AutoPoop",
    default = false,
    callback = function(state)
        if state and not autoPoopEnabled then
            startAutoPoop()
            autoPoopEnabled = true
            GUI:CreateNotify({ title = "AutoPoop", description = "AutoPoop enabled!" })
        elseif not state and autoPoopEnabled then
            stopAutoPoop()
            autoPoopEnabled = false
            -- Reset character when AutoPoop is disabled
            local char = LocalPlayer.Character
            if char and char:FindFirstChild("Humanoid") then
                -- Try killing humanoid (normal respawn)
                char.Humanoid:ChangeState(Enum.HumanoidStateType.Dead)
            else
                -- Fallback in case the game overrides humanoid death
                pcall(function() LocalPlayer:LoadCharacter() end)
            end
            GUI:CreateNotify({ title = "AutoPoop", description = "AutoPoop disabled! Character reset." })
        end
    end
})

-- Teleports Tab
local teleportsTab = GUI:CreateTab("Teleports", "map")
GUI:CreateSection({ parent = teleportsTab, text = "Teleport Locations" })

local function teleportTo(x, y, z)
    -- Safely set CFrame if character exists and has primary part
    if LocalPlayer and LocalPlayer.Character and LocalPlayer.Character.PrimaryPart then
        LocalPlayer.Character:SetPrimaryPartCFrame(CFrame.new(x, y, z))
    else
        -- Attempt to wait for char/primary part briefly
        local char = LocalPlayer and LocalPlayer.Character
        if char then
            char:GetPropertyChangedSignal("PrimaryPart"):Wait()
            if char.PrimaryPart then
                char:SetPrimaryPartCFrame(CFrame.new(x, y, z))
            end
        end
    end
end

local teleportLocations = {
    {Name = "Sell", Pos = Vector3.new(-70, 5, -1)},
    {Name = "Shop", Pos = Vector3.new(-68, 5, -14)},
    {Name = "Potions Store", Pos = Vector3.new(-67, 5, 25)},
    {Name = "Food Store", Pos = Vector3.new(-68, 5, 10)},
    {Name = "Luck Machine", Pos = Vector3.new(-64, 4, -40)},
    {Name = "2x Size Zone", Pos = Vector3.new(2, 3, -32)},
    {Name = "Food Conveyor", Pos = Vector3.new(2, 4, 52)},
    {Name = "Poop Area", Pos = Vector3.new(43, 4, 50)},
    {Name = "Leaderboards", Pos = Vector3.new(61, 4, -1)},
    {Name = "Construction Site (Coming Soon)", Pos = Vector3.new(43, 3, -38)}
}

for _, tp in pairs(teleportLocations) do
    GUI:CreateButton({
        parent = teleportsTab,
        text = tp.Name,
        callback = function()
            teleportTo(tp.Pos.X, tp.Pos.Y, tp.Pos.Z)
            GUI:CreateNotify({ title = "Teleport", description = "Teleported to "..tp.Name })
        end
    })
end

-- Credits Tab
local creditsTab = GUI:CreateTab("Credits", "star")

-- Author
GUI:CreateSection({ parent = creditsTab, text = "Author" })
GUI:CreateParagraph({
    parent = creditsTab,
    text = "rrsmirnoff"
})

-- Links
GUI:CreateSection({ parent = creditsTab, text = "Links" })

GUI:CreateButton({
    parent = creditsTab,
    text = "Discord",
    callback = function()
        setclipboard("https://discord.gg/mgeXc8xZGw")
        GUI:CreateNotify({ title = "Link Copied", description = "Discord invite copied to clipboard!" })
    end
})

GUI:CreateButton({
    parent = creditsTab,
    text = "YouTube",
    callback = function()
        setclipboard("https://www.youtube.com/channel/UCrdD-Zsn7bP3kkCH91J_wAQ")
        GUI:CreateNotify({ title = "Link Copied", description = "YouTube channel link copied to clipboard!" })
    end
})

GUI:CreateButton({
    parent = creditsTab,
    text = "Roblox Group",
    callback = function()
        setclipboard("https://www.roblox.com/communities/34896499/puchu#!/about")
        GUI:CreateNotify({ title = "Link Copied", description = "Roblox group link copied to clipboard!" })
    end
})
